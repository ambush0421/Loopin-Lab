# Design: 실거래가 데이터 실시간 연동 (Real Price Integration)

## 1. 데이터 흐름 설계 (Data Flow)

### 1.1 외부 API 연동
- **대상:** 국토교통부_상업업무용 부동산 매매 신고 자료 (OpenAPI)
- **방식:** 백엔드 Proxy API를 통해 클라이언트와 통신.
- **파라미터:** 
  - `LAWD_CD`: 시군구코드 (5자리)
  - `DEAL_YMD`: 계약년월 (YYYYMM)
  - `serviceKey`: 인증키

### 1.2 서버 사이드 가공 (API Route)
1. 클라이언트가 `sigunguCd`와 `bjdongCd`를 전달.
2. 서버에서 최근 12개월 분량의 실거래 데이터를 월별로 순차 호출 또는 일괄 조회.
3. 전체 데이터 중 요청한 `bjdongCd`(법정동)에 해당하는 내역만 필터링.
4. **평단가 계산:** `(거래금액 / 건물면적) * 3.3` -> 평당 가격 산출.

## 2. UI/UX 반영 설계

### 2.1 지도 반영 (`InvestmentMap`)
- **Marker Color:** 대상지는 Blue, 주변 실거래 사례는 Gray 또는 Yellow로 구분.
- **Overlay:** 마커 클릭 시 [거래가 / 전용평수 / 층수]를 툴팁으로 표시.
- **Geocoding:** 실거래 데이터에는 위경도가 없으므로, 카카오 주소 검색을 통해 '지번 주소'를 좌표로 변환하여 지도에 표시.

### 2.2 차트 반영 (`MarketChart`)
- **X축:** 계약년월 (최근 12개월).
- **Y축:** 평당가 (만원).
- **Line 1:** 해당 지역(법정동) 전체 평균 추세.
- **Point:** 현재 리포트 대상 건물의 예상/입력 평당가를 하나의 점으로 표시하여 위치 비교.

## 3. 기술적 해결 과제

### 3.1 주소-좌표 변환 (Geocoding)
- 실거래 데이터의 수 수십~수백 건을 지도에 뿌리려면 좌표가 필요함.
- **해결:** 카카오 로컬 API의 `address/search`를 사용하여 실거래 지번을 좌표로 변환. 성능을 위해 변환된 좌표를 메모리에 캐싱.

### 3.2 데이터 캐싱 (Caching)
- 공공데이터 API는 속도가 느리므로, 동일 시군구/년월에 대한 요청은 1시간 동안 서버 메모리나 Redis(추후)에 캐싱하여 응답 속도 개선.

## 4. 작업 목록 (Task List)
- [ ] `api/market-price` 엔드포인트 개발 (국토부 연동)
- [ ] 카카오 로컬 API를 활용한 주소-좌표 변환 로직 구현
- [ ] `MarketChart`에 실제 데이터(`recharts`) 바인딩
- [ ] `InvestmentMap`에 실거래가 마커 렌더링 로직 추가
